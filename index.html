<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanjay's Food Delivery Locator</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: #f8f9fa; 
            margin: 0; 
            padding: 15px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }
        .container { 
            background: white; 
            padding: 25px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
            width: 100%; 
            max-width: 400px; 
            text-align: center; 
            box-sizing: border-box;
        }
        h2 { color: #2d3436; margin-bottom: 5px; }
        #map { 
            height: 250px; 
            width: 100%; 
            border-radius: 15px; 
            margin: 20px 0; 
            border: 1px solid #eee; 
            z-index: 1;
        }
        .accuracy-badge { 
            display: inline-block; 
            padding: 6px 12px; 
            background: #e3f2fd; 
            color: #1976d2; 
            border-radius: 50px; 
            font-size: 13px; 
            font-weight: 600;
        }
        button { 
            background: #00b894; 
            color: white; 
            border: none; 
            padding: 16px; 
            border-radius: 12px; 
            width: 100%; 
            font-size: 17px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(0, 184, 148, 0.3);
        }
        button:active { transform: scale(0.97); background: #00a383; }
        button:disabled { background: #ccc; box-shadow: none; cursor: not-allowed; }
        #status { font-size: 14px; color: #636e72; margin-top: 15px; line-height: 1.4; }
    </style>
</head>
<body>

<div class="container">
    <h2>Delivery Location</h2>
    <div id="accuracy" class="accuracy-badge">Initializing GPS...</div>
    
    <div id="map"></div>

    <form action="https://api.web3forms.com/submit" method="POST" id="locationForm">
        <input type="hidden" name="access_key" value="d5ceb622-59e5-41a9-89f8-41aaf5f099e4">
        <input type="hidden" name="from_name" value="Delivery App Demo">
        <input type="hidden" name="subject" value="New Delivery Location Found">
        
        <input type="hidden" name="Latitude" id="lat_input">
        <input type="hidden" name="Longitude" id="lng_input">
        <input type="hidden" name="Accuracy_Radius" id="acc_input">
        <input type="hidden" name="Google_Maps_Link" id="gmaps_input">

        <input type="hidden" name="redirect" value="https://web3forms.com/success">

        <button type="submit" id="submitBtn" disabled>Confirming Location...</button>
    </form>
    
    <div id="status">Please grant location access when prompted.</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    const statusText = document.getElementById('status');
    const accBadge = document.getElementById('accuracy');
    const submitBtn = document.getElementById('submitBtn');
    
    // Initialize Map centered on a placeholder
    const map = L.map('map').setView([0, 0], 2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);
    
    const marker = L.marker([0, 0]).addTo(map);

    // High Precision Location Tracking
    if ("geolocation" in navigator) {
        // watchPosition updates in real-time as the user moves
        navigator.geolocation.watchPosition((position) => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const accuracy = position.coords.accuracy;

            // Update UI Map
            const userPos = [lat, lng];
            map.setView(userPos, 18); // Zoom level 18 is perfect for house-level
            marker.setLatLng(userPos);

            // Populate Form Fields
            document.getElementById('lat_input').value = lat;
            document.getElementById('lng_input').value = lng;
            document.getElementById('acc_input').value = `${accuracy.toFixed(2)} meters`;
            
            // Fixed Google Maps Link Format
            const mapsUrl = `https://www.google.com/maps?q=${lat},${lng}`;
            document.getElementById('gmaps_input').value = mapsUrl;

            // UI Updates
            accBadge.textContent = `Accuracy: ${accuracy.toFixed(1)}m`;
            statusText.textContent = "High-precision location locked.";
            submitBtn.disabled = false;
            submitBtn.textContent = "Send Delivery Address";

        }, (error) => {
            let msg = "";
            switch(error.code) {
                case error.PERMISSION_DENIED: msg = "User denied location access."; break;
                case error.POSITION_UNAVAILABLE: msg = "Location info unavailable."; break;
                case error.TIMEOUT: msg = "Request timed out."; break;
                default: msg = "An unknown error occurred."; break;
            }
            statusText.textContent = "Error: " + msg;
            accBadge.style.background = "#ffebee";
            accBadge.style.color = "#c62828";
            accBadge.textContent = "GPS Error";
        }, {
            enableHighAccuracy: true, // THE KEY FOR HIGH PRECISION
            maximumAge: 0,
            timeout: 20000
        });
    } else {
        statusText.textContent = "Your browser does not support Geolocation.";
    }
</script>

</body>
</html>
